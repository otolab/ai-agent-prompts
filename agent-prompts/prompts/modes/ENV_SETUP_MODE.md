---
mode: env_setup
displayName: 環境セットアップモード
fullContent: true
exitMessage: |
  環境セットアップが完了しました。
  作業を開始できます。
---

# 環境セットアップモード

セッション開始時・コンテキスト圧縮後の環境再構築を行うモードです。

## 起動タイミング

- セッション開始時（start-session.shから自動起動）
- コンテキスト圧縮（compact）後の再構築時
- 環境の再読み込みが必要な時

## セットアップ内容

### 1. 基本設定の読み込み

以下のファイルが自動的に読み込まれ、表示されます：

- **root.md**: 個人作業指針のメインファイル
- **principles.md**: 作業原則の詳細
- **work_guidelines.md**: 作業ガイドライン
- **snippets/README.md**: 再利用可能なスクリプト集

### 2. 利用可能なモードの確認

`mode_list`を実行し、利用可能な動作モードと起動条件を確認します。

### 3. セッション開始フローの実行

start-session.shで指示される以下のステップを実行します：

#### ステップ0: 既存作業の保存
- ユーザ指示やTODOリストがあればメモとして書き出し
- 以下の作業を環境構築作業としてスケジュール

#### ステップ1: 設定ファイルの読み込み
- root.mdと指定された関連ファイルを読み込む

#### ステップ2: アシスタント動作モードの再設定
- 必要なモードを`mode_enter`で設定
- アクティブモードの状態を確認

#### ステップ2-1: Serenaのアクティベート（条件付き）
- `.serena`ディレクトリが存在する場合のみ
- Serenaプロジェクトをアクティベート

#### ステップ3: 継続作業の確認
- 継続作業がないか確認
- ユーザのリクエストを確認

#### ステップ4: 作業計画・メモの再読み込み
- 作業計画やメモを再読み込み
- 環境の再整備のために読み込んだファイルの一覧を出力

#### ステップ5: TODO再構築・作業開始
- 必要に応じてTODOを再構築
- 作業を開始

## このモードの特徴

### fullContent: true

このモードは`fullContent: true`メタデータを持つため、以下の動作をします：

- `mode_enter`実行時に、モード定義ファイルの内容を直接出力
- `@`で始まる参照ファイルも自動的に読み込んで表示
- トークン効率よりも確実性を優先

### @参照の自動解決

モード定義内に`@`で始まるパスがある場合、自動的に解決されます：

```
@principles.md → agent-prompts/prompts/principles.mdを読み込み
@../../snippets/README.md → snippets/README.mdを読み込み
```

## 使用例

```bash
# セッション開始時（start-session.shから自動起動）
mode_enter({ modes: "env_setup" })

# 手動で環境を再構築する場合
mode_enter({ modes: "env_setup" })
```

## 注意事項

- このモードは環境構築のみを行い、作業そのものは行いません
- セットアップ完了後、必要に応じて他のモード（TECH_NOTES、SPECIFICATION_RESEARCH等）に入ります
- fullContent: trueのため、出力が大きくなることがあります

## モード終了後

環境セットアップが完了したら：
1. 必要なモードに入る（TECH_NOTES、SPECIFICATION_RESEARCH等）
2. 継続作業があればTODOを再構築
3. ユーザの指示に従って作業を開始
