# 対話振り返り・改善活動指示書

## 振り返りモードの発動条件

以下の場合に振り返りモードに入る：
- ユーザが作業完了を宣言（「OK」「ありがとう」「一旦ここで」等）
- 続きの作業指示がない
- 感謝の意のみを示している

## 振り返り作業のフロー

### 1. 指摘事項の抽出と分析

#### 抽出対象
- **明示的な指摘**: ユーザが直接指摘した改善点
- **暗示的な問題**: tool rejection、やり直し要求から推測される問題
- **作業方針の変更**: 途中で方向転換が必要だった箇所

#### 分析の観点
- **汎用性**: 以下の3段階で分類
  - **一般的な原則**: どのプロジェクト・ユーザにも適用される普遍的な知見
  - **プロジェクト固有**: 特定のプロジェクト・技術スタックに依存する知見
  - **ユーザの好み**: 個人の作業スタイルや preferences に関する知見
- **重要度**: 作業品質への影響度
- **実装可能性**: 設定やプロファイルで対応可能か

### 2. 知見の抽出と体系化

#### 知見の分類と記載先

**一般的な原則** → `~/.claude/CLAUDE.md` (個人グローバル設定)
- 技術的ベストプラクティス（Git、npm、ビルドツール等）
- コミュニケーション原則（確認タイミング、情報提示方法）
- 作業進行の原則（段階的アプローチ等）

**プロジェクト固有知見** → `./CLAUDE.md` (プロジェクト固有設定)
- ディレクトリ構造や技術スタック固有の知見
- プロジェクト特有のワークフローや制約
- 特定ツールチェーンでの注意事項

**ユーザの好み** → `~/.claude/CLAUDE.md` (個人グローバル設定)
- 言語設定（日本語優先等）
- 作業スタイルの preference
- 個人的なワークフロー好み

### 3. プロファイル更新の判断基準

#### 更新すべき場合
- **新しい汎用的原則**が発見された
- **既存の原則の具体化**が必要
- **プロジェクト固有の重要な知見**がある

#### 更新しない場合
- 一時的・個別的な問題
- 既存のプロファイルで十分カバーされている
- 過度に細かい技術的詳細

### 4. プロファイル更新の実行

#### 更新対象ファイル
- `~/.claude/CLAUDE.md` - 個人グローバル設定
- `./CLAUDE.md` - プロジェクト固有設定

#### 更新時の注意点
- **重複の排除**: 既存内容との重複を避ける
- **統合と整理**: 関連する内容をまとめる
- **簡潔性の維持**: 冗長な記述を避ける
- **階層の適切化**: 重要度に応じた構造化

#### 更新パターン
1. **新規追加**: 全く新しい原則や知見
2. **既存の拡張**: 具体例や詳細の追加
3. **統合・再編**: 複数の関連項目をまとめる
4. **削除・簡素化**: 冗長な部分の除去

### 5. 更新内容の検証

#### 検証観点
- **実用性**: 実際の作業で活用できるか
- **明確性**: 理解しやすい表現になっているか
- **網羅性**: 重要な観点が漏れていないか
- **バランス**: 全体的なバランスが取れているか
- **適切な分類**: 一般的/プロジェクト固有/ユーザ好みの分類が正しいか

## 振り返り作業の実行例

### 例1: 一般的な原則の発見
```
発見: Git add時の対象指定の重要性
分類: 一般的な原則（どのプロジェクトでも適用可能）
→ ~/.claude/CLAUDE.md の「Git操作の原則」セクションに追加
```

### 例2: ユーザの好みの発見
```
発見: 日本語での作業ドキュメント作成の preference
分類: ユーザの好み（個人的な作業スタイル）
→ ~/.claude/CLAUDE.md の「言語設定」セクションに追加
```

### 例3: プロジェクト固有知見の発見
```
発見: 特定のディレクトリ構造での注意事項
分類: プロジェクト固有（karte-io-systems固有の構造）
→ ./CLAUDE.md の「Git操作の注意事項」セクションに追加
```

## 振り返り作業の完了基準

- 抽出すべき知見の分析完了
- プロファイル更新の必要性判断完了
- 必要な場合のプロファイル更新実行完了
- 更新内容の妥当性確認完了

## プロファイル整理のポイント

### 整理が必要な兆候
- ユーザから「整理を行ってください」の指示
- 同様内容の重複が複数箇所に存在
- 強調（太字）が過多で重要ポイントが不明確
- 自明な内容が詳細に記述されている
- 全体の行数が100行を大幅に超過

### 整理の原則
1. **重要度による階層化**: コア原則 → 作業ガイドライン → 設定の順
2. **強調の厳選**: 太字は真に重要な項目のみ（全体の10%以下）
3. **重複の解消**: 類似内容は統合し、一箇所にまとめる
4. **自明内容の削除**: 基本的すぎる・一般的すぎる内容は除去
5. **簡潔性の追求**: 冗長な説明を削除し、要点のみ残す

### 整理後の検証
- 重要な知見が漏れていない
- 日常作業で参照しやすい構成
- 各セクションの役割が明確
- 適切な詳細度を保持（過度な簡潔化を避ける）

## 指示ファイル構成の整理方針

### ファイル構成と役割分担

#### グローバル設定（`~/.claude/`）
- **CLAUDE.md**: 
  - **目的**: 個人作業指針のメイン設定
  - **内容**: 言語設定、コア原則、作業ガイドライン、システム設定
  - **整理方針**: 重要度による階層化、簡潔性重視、実用性確保

- **REFLECTION_INSTRUCTIONS.md**:
  - **目的**: 振り返り・改善活動の手順書
  - **内容**: 振り返りフロー、知見の分類方法、プロファイル整理手順
  - **整理方針**: 体系的な手順の明確化、整理基準の標準化

- **OPERATOR_SYSTEM.md**:
  - **目的**: オペレータモードの詳細仕様
  - **内容**: オペレータ機能の技術的詳細
  - **整理方針**: 技術仕様の正確性、機能説明の網羅性

- **TECH_NOTES.md**:
  - **目的**: 技術固有のノウハウ集
  - **内容**: 特定技術・ツールの使用方法、トラブルシューティング
  - **整理方針**: 実用的な技術情報の蓄積、検索しやすい構成

#### プロジェクト固有設定
- **./CLAUDE.md**:
  - **目的**: プロジェクト固有の作業設定
  - **内容**: ディレクトリ構造、技術スタック、プロジェクト特有のワークフロー
  - **整理方針**: プロジェクト特有の情報に特化、グローバル設定との重複回避

### ファイル間の関係性管理
- **参照関係の明確化**: 関連ファイル同士の参照を明記
- **重複の回避**: 同じ内容は一箇所にまとめ、他は参照で済ませる
- **分離基準の維持**: 一般的 vs プロジェクト固有 vs 技術固有の分類を維持
- **更新時の連携**: 関連ファイルへの影響を考慮した更新

### 整理時の判断基準
1. **適切なファイル配置**: 内容の性質に応じた適切なファイル選択
2. **参照関係の最適化**: 過度な参照を避け、自己完結性を保つ
3. **保守性の確保**: 将来の更新・修正が容易な構成
4. **利用頻度の考慮**: よく参照される内容は適切な場所に配置

---

**注意事項**:
- 振り返り作業は簡潔に行い、過度に時間をかけない
- ユーザの明示的な要求がない限り、振り返り結果をユーザに報告しない
- プロファイルの肥大化を避け、常に見通しの良い状態を維持する