# スニペット作成ガイドライン

## 基本方針

### 1. 環境独立性
- **環境固有の情報を含めない**
  - ハードコードされたプロジェクトID、パス、URLなどは避ける
  - 環境変数、設定ファイル、コマンドライン引数で設定可能にする

### 2. 実行結果の非保存
- **実行結果をファイルに保存しない**
  - 結果は標準出力に表示
  - 必要な場合はユーザーがリダイレクトで保存
  - 一時ファイルは`/tmp`を使用し、処理後は削除

### 3. 設定の外部化
- **環境変数はREADME.mdに明記**
  - 各スニペットのREADMEに環境変数リストを含める
  - 必須/オプション、デフォルト値の有無を明記
  - 記法が特殊な場合は十分に説明
  - スクリプト毎に異なる環境変数は分けて記載

### 4. ドキュメント化
- **各スニペットにREADMEを用意**
  - 目的と使用方法を明確に記載
  - 必要な環境・依存関係を明記
  - 複数の使用方法（環境変数、引数）を提示
  - 何を提供するか明確に記載

## 必須要件

### 環境変数対応
```bash
# 良い例（オプション変数、環境非依存のデフォルト値）
CERTS_DIR="${1:-${CERTS_DIR:-./output}}"

# 良い例（必須変数、エラー処理）
PROJECT="${1:-${GCP_PROJECT}}"
if [ -z "$PROJECT" ]; then
  echo "エラー: GCP_PROJECTが設定されていません" >&2
  exit 1
fi

# 悪い例
PROJECT="my-specific-project-123"
```

### エラーハンドリング
```bash
if [ ! -f "$FILE" ]; then
  echo "エラー: ファイルが存在しません: $FILE"
  exit 1
fi
```

### 一時ファイルの適切な処理
```bash
# 標準的な一時ディレクトリ取得
TMPDIR="${TMPDIR:-/tmp}"
TEMP_FILE="$TMPDIR/snippet_$$.txt"
trap "rm -f $TEMP_FILE" EXIT

# または mktemp を使用（推奨）
TEMP_FILE=$(mktemp) || exit 1
trap "rm -f $TEMP_FILE" EXIT
```

### 使用例の提供
```bash
# 環境変数を使用
source .env
./script.sh

# 引数で指定
./script.sh arg1 arg2
```

## 貢献方法

新しいスニペットを追加する際は：
1. 上記のガイドラインに従う
2. 専用ディレクトリを作成
3. README.mdに環境変数リストを明記
4. snippets/README.mdの「利用可能なスニペット」セクションに追加

## 注意事項
- **機密情報を含めない**（広い意味での機密情報）
- 実際の.envファイルはGitにコミットしない（.gitignoreに追加）
- スクリプトは可能な限りPOSIX準拠に

---
**作成**: 2025年9月26日
**最終更新**: 2025年10月1日